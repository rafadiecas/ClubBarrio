{% load static %}
{% include "barra_navegacion.html" %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Contacta con Nosotros</title>
</head>
<style>

    .btn-primary {
        background-color: #00653D ;
        border-color: #00653D !important;
    }



</style>
<body>
    <div class="container" >
        <div class="row justify-content-center align-items-center pt-5">
            <div class="col-md-6 shadow-custom pt-4 mb-3">
                <h1 class="text-center">Contacta con Nosotros</h1>
                <form id="form-id"    action="{% url 'contacto' %}" method="post" class="pt-5">
                    {% csrf_token %}
                        <div class="form-group">
                            <label for="nombre">Username:</label>
                            <input type="text" name="nombre" id="nombre" class="form-control" maxlength="20" value="{{ user.username }}" placeholder="Introduce tu nombre">
                        </div>
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" name="email" id="email" class="form-control" value= "{{ user.email }}" placeholder="Introduce tu email">
                        </div>
                        <div class="form-group">
                            <label for="asunto">Asunto:</label>
                            <select name="asunto" id="asunto" class="form-control">
                                <option value="Solicitud Campus Verano">Solicitud Campus Verano</option>
                                <option value="Problemas de Registro">Problemas de Registro</option>
                                <option value="Problemas con contraseña">Problemas con contraseña</option>
                                <option value="Problemas con suscripcion">Problemas con suscripción</option>
                                <option value="Sugerencias">Sugerencias</option>
                                <option value="Otros">Otros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="mensaje">Mensaje:</label>
                            <textarea name="mensaje" id="mensaje" class="form-control" placeholder="Cuéntanos tus dudas o sugerencias"></textarea>
                        </div>
                        <div class="d-flex justify-content-center pt-5">
                            <button type="submit" class="btn btn-primary mb-2">Enviar</button>
                        </div>
                </form>
            </div>
        </div>
    </div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Luego, incluye DataTables -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>



<script>
    // Cuando el documento esté listo, ejecuta la función
    $(document).ready(function() {
        // Escucha el evento de envío del formulario con el ID "form-id"
        $('#form-id').on('submit', function(e) {
            // Previene la acción predeterminada del evento de envío del formulario
            e.preventDefault();
            // Imprime "Form submitted" en la consola del navegador
            console.log('Form submitted');

            // Realiza una solicitud AJAX
            $.ajax({
                // La URL es el valor del atributo 'action' del formulario
                url: $(this).attr('action'),
                // El tipo de la solicitud es 'POST'
                type: 'POST',
                // Los datos enviados son los datos del formulario serializados
                data: $(this).serialize(),
                // Si la solicitud tiene éxito, ejecuta esta función
                success: function(data) {
                    // Imprime "Success:" y los datos devueltos por la solicitud en la consola del navegador
                    console.log('Success:', data);
                    // Redirige al usuario a la URL correspondiente a la vista 'inicio' en el backend de Django
                    window.location.href = "{% url 'inicio' %}";
                    // Inserta un párrafo con el mensaje de éxito devuelto por la solicitud en el elemento con el ID 'success-messages'
                    $('#success-messages').html('<p>' + data.success + '</p>');
                    // Muestra un pop-up con el mensaje de éxito
                    alert(data.success);
                },
                // Si la solicitud falla, ejecuta esta función
                error: function(jqXHR, textStatus, errorThrown) {
                    // Imprime "Error:", el texto del error y el error lanzado en la consola del navegador
                    console.log('Error:', textStatus, errorThrown);
                    // Si el estado de la respuesta es 400
                    if (jqXHR.status === 400) {
                        // Guarda los errores devueltos por la solicitud en la variable 'errores'
                        var errores = jqXHR.responseJSON.errores;
                        // Vacía el elemento con el ID 'error-messages'
                        $('#error-messages').html('');
                        // Recorre los errores
                        errores.forEach(function(error) {
                            // Inserta cada error como un párrafo en el elemento con el ID 'error-messages'
                            $('#error-messages').append('<p>' + error + '</p>');
                        });
                    }
                }
            });
        });
    });
</script>


</body>
{% include 'footer.html' %}
</html>